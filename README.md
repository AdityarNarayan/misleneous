' Code Generated by Sidekick is for learning and experimentation purposes only.
Sub CopyDataFromFiles_Sheet2()
    Dim wsList As Worksheet, wsDest As Worksheet
    Dim lastRow As Long, destRow As Long
    Dim i As Long
    Dim filePath As String, customerName As String, status As String
    Dim srcWb As Workbook, srcWs As Worksheet
    Dim srcLastRow As Long, srcLastCol As Long
    Dim dataRange As Range, j As Long, tempArr As Variant

    Set wsList = ThisWorkbook.Sheets("Sheet2") ' File paths and customer names
    Set wsDest = ThisWorkbook.Sheets("Sheet1") ' Destination for copied data

    lastRow = wsList.Cells(wsList.Rows.Count, "A").End(xlUp).Row
    destRow = wsDest.Cells(wsDest.Rows.Count, 1).End(xlUp).Row + 1

    For i = 4 To lastRow
        filePath = wsList.Cells(i, "A").Value
        customerName = wsList.Cells(i, "B").Value
        status = "Copied"
        On Error GoTo ErrHandler

        Set srcWb = Workbooks.Open(filePath, ReadOnly:=True)
        Set srcWs = srcWb.Sheets("Source ECS Data")

        srcLastRow = srcWs.Cells(srcWs.Rows.Count, 1).End(xlUp).Row
        srcLastCol = srcWs.Cells(2, srcWs.Columns.Count).End(xlToLeft).Column

        Set dataRange = srcWs.Range(srcWs.Cells(2, 1), srcWs.Cells(srcLastRow, srcLastCol))
        tempArr = dataRange.Value

        ' Add customer name as new column to the right of data
        For j = 1 To UBound(tempArr, 1)
            wsDest.Cells(destRow, 1).Resize(1, srcLastCol).Value = Application.Index(tempArr, j, 0)
            wsDest.Cells(destRow, srcLastCol + 1).Value = customerName
            destRow = destRow + 1
        Next j

        srcWb.Close False
        wsList.Cells(i, "C").Value = status
        GoTo NextFile

ErrHandler:
        status = "Error: " & Err.Description
        wsList.Cells(i, "C").Value = status
        On Error GoTo 0
        If Not srcWb Is Nothing Then srcWb.Close False

NextFile:
        Set srcWb = Nothing
        Set srcWs = Nothing
        status = ""
    Next i

    MsgBox "Process completed."
End Sub
