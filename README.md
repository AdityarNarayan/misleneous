' Code Generated by Sidekick is for learning and experimentation purposes only.
Private Function EntityChunk(tok() As String, ub As Long) As String
    Dim keep() As String
    Dim k As Long: k = 0
    Dim i As Long
    Dim w As String

    ReDim keep(0 To ub) ' Pre-size to max possible tokens

    For i = 0 To ub
        w = tok(i)
        
        ' Enhancement 1: Stop if alphanumeric and length > 4
        If IsAlphanumeric(w) And Len(w) > 4 Then
            Exit For
        End If
        
        ' Enhancement 2: Stop if "Ltd" or variation found
        If IsLtdStopWord(w) Then
            Exit For
        End If
        
        Select Case Category(w)
            Case 1 ' ALPHA
                keep(k) = w: k = k + 1
            Case 2 ' SHORTNUM
                If i < ub Then
                    If Category(tok(i + 1)) = 1 Then
                        keep(k) = w: k = k + 1
                    Else
                        Exit For
                    End If
                Else
                    Exit For
                End If
            Case Else ' 3, 4, 5: LONGNUM, NONALNUM, ALPHANUM_ID
                Exit For
        End Select
    Next i

    If k > 0 Then
        ReDim resultArr(0 To k - 1)
        For i = 0 To k - 1
            resultArr(i) = keep(i)
        Next i
        EntityChunk = Join(resultArr, " ")
    Else
        EntityChunk = ""
    End If
End Function
