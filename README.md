' Code Generated by Sidekick is for learning and experimentation purposes only.
Sub CopySelectedColumnsWithCustomerName()
    Dim wsList As Worksheet, wsDest As Worksheet
    Dim lastRow As Long, destRow As Long
    Dim i As Long
    Dim filePath As String, customerName As String, status As String
    Dim srcWb As Workbook, srcWs As Worksheet
    Dim srcLastRow As Long
    Dim dataArr As Variant, outArr As Variant
    Dim j As Long, k As Long

    Set wsList = ThisWorkbook.Sheets("Sheet2") ' Source: file paths and customer names
    Set wsDest = ThisWorkbook.Sheets("Sheet1") ' Destination for copied data

    lastRow = wsList.Cells(wsList.Rows.Count, "A").End(xlUp).Row
    destRow = wsDest.Cells(wsDest.Rows.Count, 1).End(xlUp).Row + 1

    For i = 4 To lastRow
        filePath = wsList.Cells(i, "A").Value
        customerName = wsList.Cells(i, "B").Value
        status = "Copied"
        On Error GoTo ErrHandler

        Set srcWb = Workbooks.Open(filePath, ReadOnly:=True)
        Set srcWs = srcWb.Sheets("Source ECS Data")

        srcLastRow = srcWs.Cells(srcWs.Rows.Count, "A").End(xlUp).Row
        If srcLastRow < 2 Then GoTo CloseSource ' No data to copy

        ' Read columns A:AL (1:38) and BJ (62)
        dataArr = srcWs.Range("A2:AL" & srcLastRow).Value ' rows x 38 columns
        Dim bjArr As Variant
        bjArr = srcWs.Range("BJ2:BJ" & srcLastRow).Value ' rows x 1 column

        ' Prepare output array: rows x (38 + 1 + 1) columns
        ReDim outArr(1 To UBound(dataArr, 1), 1 To 40)
        For j = 1 To UBound(dataArr, 1)
            ' Copy A:AL
            For k = 1 To 38
                outArr(j, k) = dataArr(j, k)
            Next k
            ' Copy BJ
            outArr(j, 39) = bjArr(j, 1)
            ' Add customer name
            outArr(j, 40) = customerName
        Next j

        ' Paste to destination
        wsDest.Cells(destRow, 1).Resize(UBound(outArr, 1), UBound(outArr, 2)).Value = outArr
        destRow = destRow + UBound(outArr, 1)

CloseSource:
        srcWb.Close False
        wsList.Cells(i, "C").Value = status
        GoTo NextFile

ErrHandler:
        status = "Error: " & Err.Description
        wsList.Cells(i, "C").Value = status
        On Error GoTo 0
        If Not srcWb Is Nothing Then srcWb.Close False

NextFile:
        Set srcWb = Nothing
        Set srcWs = Nothing
        status = ""
    Next i

    MsgBox "Process completed."
End Sub
